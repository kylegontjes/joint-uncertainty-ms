---
title: "Figure transition statistics"
author: "Kyle Gontjes"
date: "`r Sys.Date()`"
output: html_document
---


```{r setup, include=FALSE}
require(knitr) 
opts_knit$set(echo = FALSE,warning = FALSE, message = FALSE,error=FALSE,comment=NA) 
opts_chunk$set(echo = FALSE,warning = FALSE, message = FALSE,error=FALSE,comment=NA) 
knitr::opts_knit$set(root.dir = '~/Desktop/gl_mount/Analysis/Phyloaware/joint-uncertainty-ms/') 
```

```{r environment, echo=T, message=FALSE, include=T, results=T}
#Packages
packages <- c("tidyverse",'corHMM','phyloAMR','ggtree') 

#Load Packages
invisible(lapply(packages,library,character.only=T,quietly=T))

# Source functions
source("./lib/consistent_themes.R")

# Print environment
set.seed(0104) 
Sys.info()
sessionInfo()
```

# Load data
## Dataset

# Transition data
```{r}
synchronous_df <- readRDS("./data/empirical/phyloAMR/phenotype_genotype_synchronous_transition_statistics.RDS")
downstream_df <- readRDS("./data/empirical/phyloAMR/phenotype_genotype_downstream_transition_statistics.RDS")
```

```{r,fig.width=15,fig.height=12.25}
ymax <- max(synchronous_df  %>% select(synchronous_gains_num,synchronous_gain_loss_num,synchronous_losses_num) %>% unlist %>% as.numeric) 
axes_fill <- scale_fill_manual(breaks = c(unique(synchronous_df$phenotype_axis)%>% factor),values=c("black", "#E41A1C", "#377EB8", "#4DAF4A", "#984EA3", "#FF7F00", "#FFFF33","gray"),name="Phenotype Axis")

A <- ggplot(data=synchronous_df,aes(y=synchronous_gains_num,fill=as.factor(phenotype_axis),x=genotype)) + geom_bar(position="dodge", stat="identity") + labs(fill="Phenotype Axis") + ylab("Synchronous gains") + xlab("")+ theme_bw() + theme(legend.position="none") + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) + ylim(NA,ymax) +axes_fill

B <- ggplot(data=synchronous_df,aes(y=synchronous_gain_loss_num,fill=as.factor(phenotype_axis),x=genotype)) + geom_bar(position="dodge", stat="identity") + labs(fill="Phenotype Axis") + ylab("Phenotype gain + genotype loss") + xlab("") + theme_bw()  + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+ ylim(NA,ymax) +axes_fill

C <- ggplot(data=synchronous_df ,aes(y=synchronous_losses_num,fill=as.factor(phenotype_axis),x=genotype)) + geom_bar(position="dodge", stat="identity") + labs(fill="Phenotype Axis") + ylab("Synchronous losses") + xlab("")+ theme_bw()  + theme(legend.position="none") + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+ ylim(NA,ymax) +axes_fill

D <- ggplot(data=synchronous_df,aes(y=synchronous_loss_gain_num,fill=as.factor(phenotype_axis),x=genotype)) + geom_bar(position="dodge", stat="identity") + labs(fill="Phenotype Axis") + ylab("Pphenotype loss + genotype gain") + xlab("") + theme_bw()   + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+ ylim(NA,ymax)  +axes_fill
  
E <- ggplot(data=downstream_df,aes(y=stretches_w_gains_num,fill=as.factor(phenotype_axis),x=genotype)) + geom_bar(position="dodge", stat="identity") + labs(fill="Phenotype Axis") + ylab("Phenotype stretches with genotype gains") + xlab("") + theme_bw() +axes_fill + ylim(0,ymax) + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) 

figF <- ggplot(data=downstream_df,aes(y=stretches_w_losses_num,fill=as.factor(phenotype_axis),x=genotype)) + geom_bar(position="dodge", stat="identity") + labs(fill="Phenotype Axis") + ylab("Phenotype stretches with genotype losses") + xlab("")+ theme_bw()   + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +axes_fill + ylim(0,ymax)

legend_axes_fig <- cowplot::get_legend(D)
  
genotype_phenotype_figure <- cowplot::plot_grid(A + theme(legend.position="none"),B + theme(legend.position="none"),E+ theme(legend.position="none"),legend_axes_fig,C + theme(legend.position="none"),D + theme(legend.position="none"),figF + theme(legend.position="none"),legend_axes_fig,labels = c("A","B","C","","D","E","F",""),rel_widths = c(1,1,1,0.25,1,1,1,0.25),ncol=4)

genotype_phenotype_figure

ggsave("./figures/empirical/phyloAMR_genotype_phenotype_transitions.png",dpi = 600,bg = 'white',plot = genotype_phenotype_figure,width=15,height=12.5) 
```
